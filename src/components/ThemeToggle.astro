---
/**
 * Dark/Light Mode Toggle
 * 
 * Simple toggle between dark and light modes.
 * Works with the lab theme system (data-theme="lab-dark" / "lab-light").
 * Persists mode preference to localStorage.
 */
import { defaultTheme, defaultMode } from '../themes';
---

<button 
	id="theme-toggle"
	type="button"
	class="font-mono text-xs uppercase tracking-wider px-3 py-1.5 border border-border hover:border-accent hover:text-accent transition-colors duration-normal"
	aria-label="Toggle dark/light mode"
>
	<span id="mode-label">Dark</span>
	<span id="mode-indicator" class="text-accent ml-1">●</span>
</button>

<script define:vars={{ defaultTheme, defaultMode }}>
	function getStoredTheme() {
		if (typeof localStorage === 'undefined') return defaultTheme;
		return localStorage.getItem('themeId') || defaultTheme;
	}
	
	function getStoredMode() {
		if (typeof localStorage === 'undefined') return defaultMode;
		return localStorage.getItem('themeMode') || defaultMode;
	}

	function setMode(mode) {
		const themeId = getStoredTheme();
		const themeKey = `${themeId}-${mode}`;
		document.documentElement.setAttribute('data-theme', themeKey);
		localStorage.setItem('themeMode', mode);
		updateUI(mode);
	}

	function updateUI(mode) {
		const label = document.getElementById('mode-label');
		const indicator = document.getElementById('mode-indicator');
		
		if (label) {
			label.textContent = mode === 'dark' ? 'Dark' : 'Light';
		}
		if (indicator) {
			indicator.textContent = mode === 'dark' ? '●' : '○';
		}
	}

	function toggleMode() {
		const current = getStoredMode();
		const next = current === 'dark' ? 'light' : 'dark';
		setMode(next);
	}

	function init() {
		const mode = getStoredMode();
		updateUI(mode);
		document.getElementById('theme-toggle')?.addEventListener('click', toggleMode);
	}

	init();

	// Handle Astro view transitions
	document.addEventListener('astro:after-swap', init);
</script>
