---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Feature the most recent post
const [featuredPost, ...olderPosts] = posts;
---

<!doctype html>
<html lang="en" class="min-h-screen">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body class="min-h-screen flex flex-col bg-background text-text-primary font-body antialiased">
		<Header />
		
		<main class="flex-1 max-w-4xl mx-auto px-6 py-20 md:py-32 w-full">
			<!-- Hero Section -->
			<section class="mb-32 md:mb-40">
				<h1 class="font-heading text-6xl md:text-8xl leading-[1.05] mb-12 tracking-[-0.025em] balance-text">
					Ancient patterns in<br />
					<span class="text-accent">new tools</span>
				</h1>
				<p class="text-xl md:text-2xl leading-[1.7] text-text-secondary max-w-[55ch]">
					{SITE_DESCRIPTION}
				</p>
			</section>

			<!-- Featured Post -->
			{featuredPost && (
				<section class="mb-24">
					<div class="flex items-center gap-4 mb-10">
						<h2 class="font-heading text-xs uppercase tracking-[0.15em] text-accent font-medium">
							Latest
						</h2>
						<div class="flex-1 h-px bg-gradient-to-r from-accent/30 to-transparent"></div>
					</div>
					
					<article class="group">
						<a 
							href={`/blog/${featuredPost.id}/`}
							class="block bg-surface rounded-lg p-10 md:p-14 border-l-[6px] border-accent hover:border-accent-hover transition-all duration-normal hover:shadow-xl hover:shadow-accent/10 hover:-translate-y-0.5"
						>
							<div class="flex flex-col gap-5 mb-6">
								<h3 class="font-heading text-3xl md:text-5xl font-bold leading-[1.15] tracking-[-0.02em] group-hover:text-accent transition-colors duration-normal balance-text">
									{featuredPost.data.title}
								</h3>
								<p class="text-lg md:text-xl leading-[1.75] text-text-secondary/90">
									{featuredPost.data.description}
								</p>
							</div>
							<time 
								datetime={featuredPost.data.pubDate.toISOString()}
								class="font-mono text-xs tracking-wide text-text-muted uppercase inline-block"
							>
								<FormattedDate date={featuredPost.data.pubDate} />
							</time>
						</a>
					</article>
				</section>
			)}

			<!-- Archive -->
			{olderPosts.length > 0 && (
				<section>
					<div class="flex items-center gap-4 mb-12">
						<h2 class="font-heading text-xs uppercase tracking-[0.15em] text-accent/70 font-medium">
							Earlier Work
						</h2>
						<div class="flex-1 h-px bg-gradient-to-r from-accent/20 to-transparent"></div>
					</div>
					
					<ul class="space-y-1">
						{olderPosts.map((post) => (
							<li class="group">
								<a 
									href={`/blog/${post.id}/`}
									class="flex flex-col md:flex-row md:items-baseline gap-2 md:gap-8 py-6 border-l-[4px] border-transparent hover:border-accent hover:bg-surface/40 pl-6 -ml-6 transition-all duration-normal rounded-r"
								>
									<h3 class="font-heading text-xl md:text-2xl leading-[1.3] tracking-[-0.01em] group-hover:text-accent transition-colors flex-1 balance-text">
										{post.data.title}
									</h3>
									<time 
										datetime={post.data.pubDate.toISOString()}
										class="font-mono text-xs tracking-wide text-text-muted md:min-w-[8rem] md:text-right uppercase"
									>
										<FormattedDate date={post.data.pubDate} />
									</time>
								</a>
							</li>
						))}
					</ul>
				</section>
			)}
		</main>
		
		<Footer />
	</body>
</html>
